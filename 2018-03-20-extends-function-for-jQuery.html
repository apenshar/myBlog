<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 如何为jQuery拓展方法 · Apen Shar's Tech Blog</title><meta name="description" content="如何为jQuery拓展方法 - Apen Shar"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/myBlog/favicon.png"><link rel="stylesheet" href="/myBlog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://apenshar.github.io/myBlog/atom.xml" title="Apen Shar's Tech Blog"></head><body><div class="wrap"><header><a href="/myBlog/" class="logo-link"><img src="/myBlog/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/myBlog/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/myBlog/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/myBlog/tags" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="https://weibo.com/u/5104206638" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/apenshar" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">如何为jQuery拓展方法</h1><div class="post-info">Mar 20, 2018</div><div class="post-content"><h2 id="Write-Before"><a href="#Write-Before" class="headerlink" title="Write Before "></a>Write Before </h2><p>金三银四又来了，一大批人又在蠢蠢欲动准备细软跑，想找个好下家实现自己的人生信仰。我一个实习生也投入了这个大潮中，我仔细地总结了一下原因，大致有三个：一是领导有问题，二是薪酬有问题，三是技术和人员结构有问题。程序员工作中的三座大山啊，想清楚了这三个问题，就过果断地裸辞了，哈哈哈…… (PS:这两个月应该是HR小姐姐最忙的时候吧)<br><br>下面进入正题吧: 讲一讲如何为jQuery拓展方法(又是一个老掉牙的面试题)</p>
<blockquote>
<p>jQuery.fn</p>
</blockquote>
<p>要给 jQuery拓展方法，那就必须得深入源码了。别慌别慌，其实jQuery的源码还算好理解的，也打抽空读一读，感受一下js这十几年的沉淀。先来看看下面一段源码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">　　　init: <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">　　　  <span class="comment">//….</span></span><br><span class="line">　　　 &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>有没有发现<code>jQuery.fn = jQuery.prototype</code> ? 还不是绑到原型上，将原型上所有的方法封装好，然后在外部调用，这不就实现了吗，So easy。</p>
<blockquote>
<p>jQuery.extend(object)</p>
</blockquote>
<p>有一点jQuery基础的同学肯定知道<code>jQuery.extend(</code>这个方法，它主要用于将一个或多个对象的内容合并到目标对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123; <span class="attr">validate</span>: <span class="literal">false</span>, <span class="attr">limit</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">"foo"</span> &#125;; </span><br><span class="line"><span class="keyword">var</span> options = &#123; <span class="attr">validate</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"bar"</span> &#125;; </span><br><span class="line">jQuery.extend(settings, options);  </span><br><span class="line"><span class="comment">// -&gt; settings == &#123; validate: true, limit: 5, name: "bar" &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>眼尖的你是不是发现了，合并的时候，如果有相同的key，后一个参数中key对应的value会覆盖前一个。但是你有没有想过，这个方法也可以用来拓展函数？</p>
<p><strong>Caution</strong>： 如果只为$.extend()指定了一个参数，则意味着参数target被省略。<strong>此时，target就是jQuery对象本身。通过这种方式，我们可以为全局对象jQuery添加新的方法。</strong> 但是这样有个明显的缺点，它并不会把方法扩展到对象的实例上。 <br><br>瞧一瞧下面的这段代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">    min: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123; <span class="keyword">return</span> a &lt; b ? a : b; &#125;,</span><br><span class="line">    max: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123; <span class="keyword">return</span> a &gt; b ? a : b; &#125;</span><br><span class="line">&#125;);</span><br><span class="line">jQuery.min(<span class="number">2</span>,<span class="number">3</span>); <span class="comment">//  2 </span></span><br><span class="line">jQuery.max(<span class="number">4</span>,<span class="number">5</span>); <span class="comment">//  5</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.extend(&#123;</span><br><span class="line">    alertWhileClick:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert($(<span class="keyword">this</span>).val());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">"#input1"</span>).alertWhileClick();</span><br></pre></td></tr></table></figure>
<p>这里的 <code>$(&quot;#input1&quot;)</code>为一个jQuery实例，但它并不能调用<code>alertWhileClick</code>这个方法，<br>那么怎么做才能成功呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    alertWhileClick:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert($(<span class="keyword">this</span>).val());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">"#input2"</span>).alertWhileClick();</span><br></pre></td></tr></table></figure>
<p>这里的<code>$(&quot;#input2&quot;)</code>为一个jQuery实例，它调用成员方法 alertWhileClick后，每次被点击时它会先弹出目前输入框的值。那为什么上一个例子中<code>$.extend()</code>的写法就失败了呢？<br><br>因为<code>$.extend()</code> 的调用并不会把方法扩展到对象的实例上，引用它的方法也需要通过jQuery类来实现，如jQuery.init()，而 jQuery.fn.extend()的调用把方法扩展到了对象的prototype上，所以实例化一个jQuery对象的时候，它就具有了这些方法，这是很重要的，在jQuery.js中到处体现这一点。</p>
<p>当然，你也可以拓展一个对象到jQuery的 prototype里去，这样的话就是插件机制了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">jQuery.fn.extend = jQuery.prototype.extend</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> $ </span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    $.fn.tooltip = <span class="function"><span class="keyword">function</span>(<span class="params"> options </span>) </span>&#123;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//等价于</span></span><br><span class="line">    <span class="comment">//var tooltip = &#123;</span></span><br><span class="line">    <span class="comment">//    function(options)&#123;</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//&#125;;</span></span><br><span class="line">    <span class="comment">//$.fn.extend(tooltip) = $.prototype.extend(tooltip) = $.fn.tooltip</span></span><br><span class="line">    </span><br><span class="line">&#125;)( jQuery );</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/myBlog/2018-03-20-js-crypto-getRandomValues.html" class="prev">PREV</a><a href="/myBlog/2018-03-10-node-crawl-musicforprogramming.html" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2018 <a href="https://apenshar.github.io/myBlog">Apen Shar</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>